<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>多人聊天室遊戲</title>
  <style>
    body { font-family: sans-serif; background: #222; color: #eee; }
    #chat { width: 400px; margin: 40px auto; background: #333; padding: 20px; border-radius: 8px; }
    #messages { height: 300px; overflow-y: auto; background: #222; padding: 10px; border-radius: 4px; margin-bottom: 10px; }
    .owner { color: gold; font-weight: bold; }
    .msg { margin: 4px 0; }
    #input, #password { width: 70%; padding: 6px; }
    #send, #setname { padding: 6px 12px; }
  </style>
</head>
<body>
  <div id="chat">
    <div id="login">
      <input id="username" placeholder="輸入暱稱 (owner=擁有者)" />
      <input id="password" type="password" placeholder="擁有者密碼(選填)" />
      <button id="setname">進入聊天室</button>
    </div>
    <div id="room" style="display:none;">
      <div id="messages"></div>
      <input id="input" autocomplete="off" placeholder="輸入訊息..." />
      <button id="send">送出</button>
    </div>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let isOwner = false;

    document.getElementById('setname').onclick = function() {
      const name = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      if (!name) return alert('請輸入暱稱');
      socket.emit('set username', { name, password });
    };

    socket.on('username set', ({ success, isOwner: ownerFlag }) => {
      if (success) {
        isOwner = ownerFlag;
        document.getElementById('login').style.display = 'none';
        document.getElementById('room').style.display = '';
      }
    });

    document.getElementById('send').onclick = sendMsg;
    document.getElementById('input').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') sendMsg();
    });

    function sendMsg() {
      const input = document.getElementById('input');
      const msg = input.value.trim();
      if (!msg) return;
      socket.emit('chat message', msg);
      input.value = '';
    }

    socket.on('chat message', ({ user, msg, isOwner }) => {
      const messages = document.getElementById('messages');
      const div = document.createElement('div');
      div.className = 'msg' + (isOwner ? ' owner' : '');
      div.innerHTML = `<span>${isOwner ? '👑' : ''}<b>${user}</b>：</span> ${msg}`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    });
  </script>
</body>
</html>
